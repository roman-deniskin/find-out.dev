# Документация

### Приложение

#### Установка с нуля

* Открываем консоль, переходим в папку со всеми доменами. OpenServer: `cd domains`

* `git clone https://github.com/roman-deniskin/find-out.dev.git find-out.dev`

* `cd find-out.dev`

* `composer install`

* `php artisan vendor:publish`

* `php artisan key:generate`

* Создаем базу данных и прописываем данные для подключения в файле .env (см.п. Настройка)

* Выполняем комманду миграций: `php artisan module:migrate`

#### Настройка

* Указать в настройках сервера директорию проекта public

* Скопировать файл .env.example в корневую директорию и переименовать в .env

* В файле .env прописать данные для соединения с базой данных

#### Обновление

(если у вас уже есть установленный проект и его нужно обновить до актуальной версии)
Открываем консоль, переходим в папку с проектом (`cd domains/find-out.dev`)

* `git pull origin master` -- обновляемся до стабильной версии

Если эта команда вызывает ошибки то скорее всего вы сделали какие то изменения,
нужно либо сбросить их, либо сделать коммит

Сбросить -- только если вы не сделали ничего важного, все ваши изменения будут потеряны:
`git reset` и дальше по плану `git pull origin master`

Закоммитить изменения:
`git status` -- проверяем на какой мы ветке (в начале должно написать On branch {ВЕТКА} )
и какие файлы изменены

Если изменения вами оттестированы то можете заливать коммит в ветку master,
а потом делать пулл реквест в главный репозиторий, если же нет,
то лучше переключится на какую то другую ветку
git checkout -b {НАЗВАНИЕ_ВЕТКИ}

-- Латинскими буквами, без пробелов

Когда разобрались с веткой можно приступить к сохранению изменений:

* `git add ./` - добавляет всё изменения в коммит

* `git commit -m "{Укажите комментарий, опишите что вы сделали в 2х словах}"`

* `git push origin {НАЗВАНИЕ_ВЕТКИ}`

ну и вводим логин и пароль, всё, изменения сохранены, можем спокойно делать `git pull origin master`

После того как git нам стянул последнюю стабильную версию проекта делаем следующее:

* `composer install`

* `php artisan vendor:publish`

* `composer dump-autoload`

* `php artisan module:migrate`

На этом обновление завершено.

### Модули

#### Создание

-Будет сгенерирован модуль Blog:

`php artisan module:make Blog`

-Будут сгенерированы 3 модуля с соответствующими названиями:

`php artisan module:make Blog Portfolio User`

#### Публикация
В composer.json должны быть строки:

```
	"psr-4": {
            "App\\": "app/",
            "Modules\\": "Modules"
        }
```

Если их нет - следует обновиться до последней версии репозитория так как автозагрузка модулей не будет работать.

После создания модуля его нужно опубликовать командой:

`composer dump-autoload`

#### Миграции в модулях

`php artisan module:make-migration <MigrationName> <ModuleName>`

Например:

`php artisan module:make-migration create_table_users user`

##### Выполнить миграцию:

`php artisan module:migrate`

---------------------------------------

### Установка проекта на сервер (Production)

* Полностью-рабочую версию проекта запаковать в zip архив

* Очистить таблицы users & users_activation

* Сделать дамп базы данных

После этого у нас должен быть zip архив с проектом и sql файл с таблицами

* Выгружаем архив на хостинг (обычно в корень, иногда в папку public | public_html | htdocs и т.п)

* Создаем базу данных, импортируем в нее наш дамп (.sql файл)

* В файле .env меняем:
APP_ENV=local => production
APP_DEBUG=true => false

Там же, есть соединение с mail сервером, прописываем данные.

* Открываем config/mail.php

* В самом конце есть `'pretend' => true,`

* Меняем `true` на `false`

Проверяем. Если сайт не работает проверьте есть ли в корне (именно в корне, а не в папке public)
файл .htaccess с таким содержимым:

```
Options +SymLinksIfOwnerMatch
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule ^(.*)$ public/$1 [L]
</IfModule>
```

Если нету -- создаем и копируем то что выше.

#### Тесты. phpunit тестирование.

Пока что у нас тесты не полностью покрывают функционал приложения, но мы постоянно их совершенствуем, запустить тесты не сложно:

открываем консоль, в ней нужно создать 2 вкладки (потом поймете почему), в обеих вкладках переходим в папку с проектом:

`cd domains/find-out.dev`

В первой вкладке нужно прописать:

`php artisan serve`

Не ждем пока комманда выполнится, она просто запускает наш локальный сервер который доступен по адресу: http://localhost:8080

Сразу переходим во вторую вкладку, в которой пишем:

`php vendor/phpunit/phpunit/phpunit`

Это и запускает наши тесты, если всё прошло успешно будет отображено сообщение что тесты завершились без проблем,
если же нет -- будет много кода, это значит что что то пошло не так, в самом верху вы можете узнать какой именно тест не прошел.

--------------------

#### У меня ошибка!!!

В этом разделе будут описаны действия по исправлению самых частых ошибок:

* Я делаю изменения, а их не видно, что случилось?
-- Проверьте папку resources/views и resources/lang если в этих папках есть папка modules
-- удалите ее, да да, просто удалите ее, она создается коммандой `php artisan vendor:publish`
На локалке она не нужна.

По всем ошибкам обращаться сюда: [Valentin Sayik](http://vk.com/sv_backend1)

--------------------

Полная документация по модулях есть на [оффициальном сайте пакета](http://sky.pingpong-labs.com/docs/2.0/modules)

### Работа с изображениями

Мы используем [ImageManager](https://github.com/anakadote/ImageManager-for-Laravel-5)
